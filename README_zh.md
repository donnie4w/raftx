# **RaftX**

RaftX 是一种对经典 Raft 协议的扩展，结合了 Multi-Paxos、ZAB（Zookeeper Atomic Broadcast）和 Raft 协议的优势。RaftX 具备快速选举、并发提案、数据同步、数据回滚以及易失性数据同步等特性，适用于高并发和大规模分布式系统场景。

---

## **目录**

1. [背景介绍](#背景介绍)
2. [特性概述](#特性概述)
3. [系统架构](#系统架构)
4. [安装指南](#安装指南)
5. [使用方法](#使用方法)
6. [应用场景](#应用场景)
7. [许可证](#许可证)

---

## **背景介绍**

在分布式系统中，为了确保数据一致性，通常需要使用共识算法来协调多个节点的状态。传统的 **Raft** 协议虽然易于理解，但在高并发、节点数量多、以及大规模数据同步的场景下存在一定的局限性。为此，RaftX 对 Raft 进行了扩展，结合了 **Multi-Paxos** 的并发提案能力和 **ZAB** 的数据同步特性，提供了更高效、更稳定的分布式共识解决方案。

[raftx wiki](https://tlnet.top/wiki/raftx)
---

## **特性概述**

### 1. **快速选举机制**

- 选举基于 Raft 的多数派原则，并进行扩展，确保在一个任期中必定选出Leader。
- 避免了 Raft 中投票时循环互投导致的多轮重选问题。
- 通常3-15个集群节点中，选举不会超过1秒
- 即使在几十个节点的集群中，正常情况下可在 **0-2秒内完成选举**，它的主要耗时转移到节点的消息通知上。

### 2. **并发提案与日志同步**

- 类似于 **Multi-Paxos**，支持多个提案并发处理，日志与事务支持无序提交，提升并发处理能力，适用与高并发场景。

### 3. **数据同步与回滚**

- 类似 **ZAB** 的数据同步特性，Leader 和 Follower 都会自动检测并同步缺失的数据。
- 在集群故障或提案失败时，自动回滚数据，保持节点间数据一致性。

### 4. **支持分布式易失性数据**
#####  易失性数据：是指那些无需持久化存储的数据，尤其是在快速失效后不再需要保留的数据。这类数据的特点是生命周期短、更新频繁，并且在某些情况下可以容忍丢失。
#####  Raftx的易失性数据功能本身不属于协议的一部分，它只是raftx的扩展功能，主要依托raftx的网络架构与部分同步协议实现，它没有持久化数据日志，因此无法像raftx集群一样：无论何时新增节点，都可以百分百同步所有数据；它依赖日志缓存池的长度，目前为1048576,即记录最近1048576条数据日志，如果集群节点断开了后重连，那么只要未同步的数据数小于1048576条，都可以同步回来，反之，如果超过了，那么将只同步最近1048576条数据。
##### 易失性数据协同由于没有持久化，它效率将非常高。对于集群系统的及时性起到至关重要的作用。
##### 易失性数据的获取与raftx相似，它可以向集群获取，也可以向本地获取；向集群获取时，它保证了得到集群系统的强一致性结果。而向本地获取时，则是一个最终一致性的效果，即可能获取到脏数据，它的特点是高效，与向本地缓存获取数据效率无异。选择何种方式获取数据取决于具体业务的特性与需求。
##### 易失性数据作用非常广泛，对协同集群操作有重要的作用，可以应用于大量分布式服务中，如 分布式锁，分布式日志系统，分布式消息通知等。
#### 易失性数据的特点
- 高效数据协同操作
  - 易失性数据设计用于快速读写和高并发场景，通常优化了内存中的存取效率，以支持大量的实时交互需求 
- 数据操作的有序性协同操作，增删改操作在每个节点的顺序一致。
  - 在分布式环境中，确保增删改操作在每个节点上的顺序一致至关重要，它保证全局视图的一致性和正确性 
- TTL（time to live）数据在内存在都有特定存活时间。
  - 每个易失性数据项都可以设置一个存活时间（TTL），超过这个时间后，数据自动过期并从内存中移除 
- 事件监听与触发
  - 对数据增删改等数据操作的事件监听与事件触发操作 
- 强一致性
  - 数据读写强一致性 

---

## **系统架构**

```
+-----------------------------------------+
|                Raftx Api                |
+-----------------------------------------+
           |                 |
           v                 v
+-------------------+   +-------------------+
|       Node 1      |   |       Node 2      |
| (Leader/Follower) |   | (Leader/Follower) |
+-------------------+   +-------------------+
           |                 |
           v                 v
+-------------------+   +-------------------+
|       Node 3      |   |       Node 4      |
| (Leader/Follower) |   | (Leader/Follower) |
+-------------------+   +-------------------+
```

### **组件说明**

1. **Leader**：负责接收客户端请求，进行提案并同步日志。
2. **Follower**：执行leader数据提案与数据提交，数据回滚，代理客户端请求等操作。
3. **Raftx Api**：向集群发送请求，获取数据或提交状态更新。

---

## **安装指南**

### **依赖环境**

- **操作系统**：Linux、macOS、Windows
- **编程语言**：Go 1.22 或更高版本
- **依赖工具**：Git

### **安装项目**

```bash
go get github.com/donnie4w/raftx
```



### **API 调用示例**

```go
config := &Config{ListenAddr: ":20001", PeerAddr: []string{"localhost:20001","localhost:20002","localhost:20003"}}
raft := NewRaftx(config)
raft.Open()
```
---

## **应用场景**

1. **高并发分布式存储系统**
    - 适用于需要快速提案和并发日志同步的数据库、KV 存储等。

2. **实时状态同步系统**
    - 用户在线状态、位置信息等需要快速失效的易失性数据同步。

3. **大规模集群选举**
    - 适合需要快速选举 Leader 的大规模分布式系统。

4. **网址系统与 CDN**
    - 在集群间快速共享易失性数据，提高系统响应速度和可用性。

---


## **许可证**

RaftX 使用 [Apache-2.0 license](https://github.com/donnie4w/raftx?tab=Apache-2.0-1-ov-file#readme)。